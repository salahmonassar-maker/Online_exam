<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</title>
<style>
body{font-family:Tahoma;direction:rtl;background:#1b2735;color:#fff;margin:0;padding:0;}
.container{max-width:800px;margin:auto;background:#2c3e50;border-radius:15px;padding:20px;margin-top:20px;}
h1,h2,h3{color:#ffdd57;}
input,button,select{padding:6px;margin:4px 0;border-radius:6px;border:none;font-size:14px;width:48%;max-width:200px;}
button{background:#f39c12;cursor:pointer;}button:hover{background:#f1c40f;}
table{width:100%;border-collapse:collapse;}th,td{border:1px solid #fff;padding:6px;text-align:center;}
</style>
</head>
<body>
<div class="container">
<h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª â€“ Ø§Ù„Ù…Ø¹Ù„Ù…</h1>

<h3>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h3>
<select id="examSelect"><option value="">-- Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹ --</option></select>
<br>
<button onclick="loadExamForTeacher()">ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
<button onclick="showExam()" style="background:#27ae60;color:#fff">ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨</button>
<button onclick="deleteExam()" style="background:#e74c3c;color:#fff">âŒ Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>

<hr>

<h3>Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ</h3>
<button onclick="publishDemoExam()">ğŸ’¾ Ù†Ø´Ø± Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ</button>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// ---- Firebase ----
const firebaseConfig={
apiKey:"AIzaSyAC4PNyd-nolBmhhbn_AIWS5e1FaN4DoMI",
authDomain:"online-exam-3d750.firebaseapp.com",
projectId:"online-exam-3d750"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
db.enablePersistence().catch(err=>console.log(err));

const examSelect=document.getElementById("examSelect");
let currentExamId=null;

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
async function loadExamList(){
    examSelect.innerHTML='<option value="">-- Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹ --</option>';
    const snapshot=await db.collection("exams").orderBy("createdAt").get();
    snapshot.forEach(doc=>{
        const d=doc.data();
        let opt=document.createElement("option");
        opt.value=doc.id;
        opt.text=d.subject+" - "+d.topic;
        examSelect.appendChild(opt);
    });
}
loadExamList();

// Ù†Ø´Ø± Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¬Ø§Ù‡Ø²
function publishDemoExam(){
    const docId="DemoMathTest";
    const demoExam={
        subject:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
        topic:"Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ",
        numQuestions:2,
        timeLimit:5,
        isPublished:true,
        createdAt:firebase.firestore.FieldValue.serverTimestamp(),
        questions:[
            {q:"2+2=", o:["3","4","5","6"], a:1},
            {q:"5-3=", o:["1","2","3","4"], a:1}
        ]
    };
    db.collection("exams").doc(docId).set(demoExam)
    .then(()=>{alert("âœ”ï¸ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ"); loadExamList();})
    .catch(err=>alert("âŒ Ø®Ø·Ø£: "+err));
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨
function showExam(){
    const selected=examSelect.value;
    if(!selected){alert("Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹"); return;}
    db.collection("exams").doc(selected).update({isPublished:true})
    .then(()=>{alert("âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨"); loadExamList();})
    .catch(err=>alert(err));
}

// Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
function deleteExam(){
    const selected=examSelect.value;
    if(!selected){alert("Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹"); return;}
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ")){
        db.collection("exams").doc(selected).delete()
        .then(()=>{alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù"); loadExamList();})
        .catch(err=>alert(err));
    }
}
</script>
</body>
</html>
